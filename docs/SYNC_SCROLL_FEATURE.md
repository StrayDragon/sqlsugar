# Jinja2 Editor V2 联动滚动功能

## 功能概述

为 Jinja2 Editor V2 添加了 Template Editor 和 SQL Preview 面板之间的联动滚动功能，允许用户在滚动模板编辑器时，SQL 预览面板会同步滚动到相应位置，反之亦然。这对于对比长模板和其渲染结果非常有用。

## 功能特性

### 🔗 联动滚动按钮
- **位置**：Jinja2 Editor V2 头部工具栏，位于变量日志按钮（📋 变量日志）的左边
- **图标**：🔗（链接图标）
- **状态指示**：启用时按钮正常显示，禁用时为普通状态

### 使用方式

1. **启用联动滚动**：
   - 点击主编辑器头部的**🔗 联动**按钮
   - 系统会显示通知提示联动滚动已启用
   - 现在滚动 Template Editor 时，SQL Preview 会同步滚动

2. **禁用联动滚动**：
   - 再次点击主编辑器头部的**🔗 联动**按钮
   - 系统会显示通知提示联动滚动已禁用
   - 两个面板的滚动将独立进行

3. **双向同步**：
   - 滚动 Template Editor → SQL Preview 同步滚动
   - 滚动 SQL Preview → Template Editor 同步滚动
   - 基于滚动比例进行智能映射

## 技术实现

### 核心算法
- **比例映射**：基于滚动高度比例计算目标位置
- **双向同步**：支持 Template Editor → SQL Preview 和 SQL Preview → Template Editor 双向同步
- **智能计算**：根据内容高度差异计算合适的滚动比例

### 用户体验优化
- **平滑动画**：使用 `scroll-behavior: smooth` 实现平滑滚动
- **防循环触发**：避免滚动事件的循环触发
- **即时响应**：滚动事件立即触发同步，无延迟
- **智能通知**：启用/禁用时显示相应的通知提示

### 组件架构
- **主控制器**：Jinja2 Editor V2 管理联动滚动状态
- **滚动容器检测**：自动识别 Template Editor 和 SQL Preview 的滚动容器
- **事件监听管理**：动态添加和移除滚动事件监听器
- **资源清理**：组件销毁时自动清理事件监听器

## 测试覆盖

功能包含完整的单元测试：
- ✅ 联动滚动按钮创建和显示
- ✅ 主编辑器中启用联动滚动
- ✅ 联动滚动状态管理
- ✅ Template Editor 和 SQL Preview 滚动容器检测

## 使用场景

1. **模板调试**：对比长 Jinja2 模板和渲染后的 SQL
2. **代码审查**：检查模板逻辑和结果的对应关系
3. **教学演示**：展示模板变量替换的效果
4. **文档编写**：在生成模板示例时保持对应关系

## 注意事项

- 联动滚动功能在内容长度足够需要滚动时效果最明显
- 基于滚动比例进行映射，当两个面板内容高度差异较大时，滚动位置可能不是完全线性的
- 功能在启用时会立即生效，无需额外配置
- 建议在处理长模板时启用此功能以获得最佳体验