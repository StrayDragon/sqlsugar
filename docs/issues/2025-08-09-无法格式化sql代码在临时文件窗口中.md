# 无法格式化 SQL 代码在临时文件窗口中

**问题描述**
- 用户报告在使用 "Edit Inline SQL" 功能打开 SQL 临时文件时，格式化操作导致 sqls 崩溃
- 错误信息为 `runtime error: invalid memory address or nil pointer dereference`，发生在 `textDocument/formatting` 请求中

**重现步骤**
1. 选中包含 SQL 的字符串
2. 右键选择 "Edit Inline SQL"
3. 在新打开的 .sql 临时文件中进行编辑或保存
4. 如果 `sqlsugar.autoFormat` 为 true，会自动触发格式化请求
5. sqls 在处理格式化时发生 panic

**错误堆栈**
```
panic serving textDocument/formatting: runtime error: invalid memory address or nil pointer dereference
github.com/sqls-server/sqls/ast.joinRender
github.com/sqls-server/sqls/ast.(*ItemWith).Render
github.com/sqls-server/sqls/internal/formatter.Format
github.com/sqls-server/sqls/internal/handler.(*Server).handleTextDocumentFormatting
```

**当前状态**
- 问题出现在 sqls v0.2.28 版本
- 似乎与 AST 渲染过程中的空指针访问有关
- 可能与数据库连接状态或特定 SQL 语法有关

**临时解决方案**
1. 将 `sqlsugar.autoFormat` 设置为 `false` 以避免自动格式化
2. 手动格式化时需要小心，可能仍会触发相同问题

**长期解决方案**
1. 升级到更新版本的 sqls（如果有）
2. 在扩展中捕获格式化错误并提供降级处理
3. 提供更精细的格式化控制选项
4. 考虑使用其他 SQL 格式化工具作为备选

**相关配置**
- `sqlsugar.autoFormat`: 控制是否自动格式化
- `sqlsugar.sqlsPath`: sqls 可执行文件路径
- `sqlsugar.sqlsConfigPath`: sqls 配置文件路径

**记录时间**: 2025-08-09  
**优先级**: 中等（有临时解决方案）