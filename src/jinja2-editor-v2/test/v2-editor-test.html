<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jinja2 Editor V2 - Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }

        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .test-header {
            margin-bottom: 30px;
        }

        .test-header h1 {
            color: #ffffff;
            margin: 0;
        }

        .test-header p {
            color: #9d9d9d;
            margin: 5px 0 0 0;
        }

        .test-controls {
            background: #2d2d30;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #3e3e42;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #cccccc;
        }

        .control-group textarea {
            width: 100%;
            height: 120px;
            background: #3c3c3c;
            color: #cccccc;
            border: 1px solid #3c3c3c;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            resize: vertical;
        }

        .control-group textarea:focus {
            outline: none;
            border-color: #007fd4;
            box-shadow: 0 0 0 2px rgba(0, 127, 212, 0.2);
        }

        .control-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .test-button {
            background: #0e639c;
            color: #ffffff;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: background-color 0.15s ease;
        }

        .test-button:hover {
            background: #1177bb;
        }

        .test-button.secondary {
            background: #3c3c3c;
            color: #cccccc;
        }

        .test-button.secondary:hover {
            background: #4a4a4a;
        }

        .editor-container {
            height: 600px;
            border: 1px solid #3e3e42;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .test-info {
            background: #2d2d30;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #3e3e42;
            font-size: 13px;
        }

        .test-info h3 {
            margin: 0 0 10px 0;
            color: #ffffff;
        }

        .test-info ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .test-info li {
            margin-bottom: 5px;
        }

        .error-message {
            background: #5a1d1d;
            color: #f48771;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #8c2d2d;
            margin-top: 10px;
        }

        .success-message {
            background: #1d3a1d;
            color: #89d185;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #2d5a2d;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üé® Jinja2 Editor V2 - Test Page</h1>
            <p>Interactive testing environment for the new V2 visual editor</p>
        </div>

        <div class="test-controls">
            <div class="control-group">
                <label for="template-input">Jinja2 Template:</label>
                <textarea id="template-input" placeholder="Enter your Jinja2 template here...

Example:
SELECT * FROM users
WHERE id = {{ user_id }}
  AND status = '{{ status }}'
  AND created_at >= '{{ start_date }}'
  AND name LIKE '{{ search_pattern }}%'">{{ default_template }}</textarea>
            </div>

            <div class="control-buttons">
                <button class="test-button" onclick="loadTemplate('simple')">Load Simple Template</button>
                <button class="test-button" onclick="loadTemplate('complex')">Load Complex Template</button>
                <button class="test-button" onclick="loadTemplate('variables')">Load Variable Examples</button>
                <button class="test-button secondary" onclick="clearTemplate()">Clear</button>
            </div>
        </div>

        <div class="editor-container">
            <!-- V2 Editor will be rendered here -->
            <div id="editor-mount"></div>
        </div>

        <div class="test-info">
            <h3>üéØ Test Features</h3>
            <ul>
                <li><strong>Direct Template Interaction:</strong> Click on highlighted variables to edit them</li>
                <li><strong>Smart Popovers:</strong> Variables open with context-aware editing options</li>
                <li><strong>Keyboard Navigation:</strong> Use Tab, Enter, Escape to navigate</li>
                <li><strong>Real-time Preview:</strong> See SQL changes as you edit</li>
                <li><strong>Responsive Layout:</strong> Try resizing the window to see layout changes</li>
            </ul>

            <h3>‚å®Ô∏è Keyboard Shortcuts</h3>
            <ul>
                <li><code>Tab</code> - Navigate to next variable</li>
                <li><code>Shift + Tab</code> - Navigate to previous variable</li>
                <li><code>Enter</code> - Edit selected variable</li>
                <li><code>Escape</code> - Close editor / Clear selection</li>
                <li><code>Ctrl + ?</code> - Show keyboard help</li>
            </ul>

            <div id="message-container"></div>
        </div>
    </div>

    <!-- Include the V2 Editor components -->
    <script type="module">
        // Import V2 Editor components
        import { Jinja2EditorV2 } from '../components/jinja2-editor-v2.js';
        import { V2EditorConfig } from '../config/v2-editor-config.js';
        import { generateDesignSystemCSS, generateThemeVariables } from '../styles/design-system.js';
        import { generateAnimationCSS } from '../styles/animations.js';

        // Inject design system CSS
        const styleSheet = document.createElement('style');
        styleSheet.textContent = `
            ${generateDesignSystemCSS()}
            ${generateAnimationCSS()}
            ${generateThemeVariables('dark')}
        `;
        document.head.appendChild(styleSheet);

        // Default templates for testing
        window.templates = {
            simple: `SELECT * FROM users WHERE id = {{ user_id }} AND status = '{{ status }}'`,
            complex: `SELECT
    u.id, u.name, u.email,
    COUNT(o.id) as order_count,
    SUM(o.total) as total_spent
FROM users u
LEFT JOIN orders o ON u.id = o.user_id
WHERE
    u.status = '{{ user_status }}'
    AND u.created_at >= '{{ start_date }}'
    AND (u.email LIKE '{{ email_pattern }}%' OR u.name LIKE '{{ name_pattern }}%')
    ${include_inactive ? "AND u.is_active = false" : ""}
GROUP BY u.id, u.name, u.email
HAVING COUNT(o.id) >= {{ min_orders }}
ORDER BY total_spent {{ sort_direction }}
LIMIT {{ result_limit }}`,
            variables: `-- Variable type examples
SELECT
    '{{ string_var }}' as text_value,
    {{ number_var }} as number_value,
    {{ boolean_var }} as boolean_value,
    '{{ date_var }}' as date_value,
    '{{ uuid_var }}' as uuid_value,
    '{{ email_var }}' as email_value,
    '{{ url_var }}' as url_value
FROM test_table
WHERE
    id IN ({{ id_list | join(',') }})
    AND created_by = {{ user_id }}
    AND status IN ({{ status_list | join("','") }})`
        };

        // Editor configuration
        const config = {
            enabled: true,
            popoverPlacement: 'auto',
            highlightStyle: 'background',
            autoPreview: true,
            keyboardNavigation: true,
            animationsEnabled: true,
            showSuggestions: true,
            autoFocusFirst: false
        };

        // Create and mount the editor
        const editorContainer = document.getElementById('editor-mount');
        const editor = new Jinja2EditorV2();

        // Configure the editor
        editor.config = config;
        editor.theme = 'vscode-dark';
        editor.showOriginal = true;
        editor.title = 'Jinja2 Template Editor V2 - Test';

        // Event listeners
        editor.addEventListener('template-render', (event) => {
            console.log('Template rendered:', event.detail);
            showMessage('Template rendered successfully!', 'success');
        });

        editor.addEventListener('variable-change', (event) => {
            console.log('Variable changed:', event.detail);
        });

        editor.addEventListener('template-submit', (event) => {
            console.log('Template submitted:', event.detail);
            showMessage('Template submitted successfully!', 'success');
        });

        // Mount the editor
        editorContainer.appendChild(editor);

        // Global functions for test buttons
        window.loadTemplate = function(templateName) {
            const template = window.templates[templateName];
            if (template) {
                document.getElementById('template-input').value = template;
                editor.template = template;
                showMessage(`Loaded ${templateName} template`, 'success');
            }
        };

        window.clearTemplate = function() {
            document.getElementById('template-input').value = '';
            editor.template = '';
            showMessage('Template cleared', 'success');
        };

        window.showMessage = function(message, type = 'info') {
            const container = document.getElementById('message-container');
            const messageDiv = document.createElement('div');
            messageDiv.className = `${type}-message`;
            messageDiv.textContent = message;

            container.innerHTML = '';
            container.appendChild(messageDiv);

            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        };

        // Load initial template
        window.loadTemplate('simple');

        // Sync template input with editor
        document.getElementById('template-input').addEventListener('input', (e) => {
            editor.template = e.target.value;
        });

        // Add some test utility functions to global scope
        window.testEditor = {
            editor,
            config,

            // Test different configurations
            testHighlightStyle: function(style) {
                editor.config = { ...config, highlightStyle: style };
                showMessage(`Changed highlight style to: ${style}`, 'success');
            },

            testPopoverPlacement: function(placement) {
                editor.config = { ...config, popoverPlacement: placement };
                showMessage(`Changed popover placement to: ${placement}`, 'success');
            },

            toggleAnimations: function() {
                const newConfig = { ...config, animationsEnabled: !config.animationsEnabled };
                editor.config = newConfig;
                showMessage(`Animations ${newConfig.animationsEnabled ? 'enabled' : 'disabled'}`, 'success');
            },

            toggleKeyboardNav: function() {
                const newConfig = { ...config, keyboardNavigation: !config.keyboardNavigation };
                editor.config = newConfig;
                showMessage(`Keyboard navigation ${newConfig.keyboardNavigation ? 'enabled' : 'disabled'}`, 'success');
            },

            // Get current editor state
            getState: function() {
                return {
                    template: editor.template,
                    values: editor.editorState?.values || {},
                    variables: editor.editorState?.variables || [],
                    config: editor.config
                };
            },

            // Log current state for debugging
            logState: function() {
                console.log('Editor State:', this.getState());
            }
        };

        // Console instructions
        console.log('üé® Jinja2 Editor V2 Test Environment Loaded');
        console.log('Available test functions:');
        console.log('- testEditor.testHighlightStyle("background"|"border"|"underline")');
        console.log('- testEditor.testPopoverPlacement("auto"|"top"|"bottom"|"left"|"right")');
        console.log('- testEditor.toggleAnimations()');
        console.log('- testEditor.toggleKeyboardNav()');
        console.log('- testEditor.getState()');
        console.log('- testEditor.logState()');
        console.log('- loadTemplate("simple"|"complex"|"variables")');
        console.log('- clearTemplate()');
        console.log('- showMessage("message", "success"|"error"|"info")');
    </script>
</body>
</html>